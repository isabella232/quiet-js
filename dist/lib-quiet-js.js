!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=11)}([function(e,t,n){"use strict";t.a={get:function(){return this.libQuiet},set:function(e){this.libQuiet=e}}},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return i});var r=Math.pow(2,14),i=16384},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(0);function i(e,t,n){var i=r.a.get(),a=i.intArrayFromString(JSON.stringify({profile:t})),s=i.intArrayFromString("profile"),o=i.ccall("quiet_".concat(e,"_profile_str"),"pointer",["array","array"],[a,s]),c=i.ccall("quiet_".concat(e,"_create"),"pointer",["pointer","number"],[o,n]);return i.ccall("free",null,["pointer"],[o]),c}},,,,function(e,t,n){"use strict";t.a={audible:{checksum_scheme:"crc32",encoder_filters:{dc_filter_alpha:.01},frame_length:100,inner_fec_scheme:"v27",interpolation:{excess_bandwidth:.35,samples_per_symbol:10,shape:"kaiser",symbol_delay:4},mod_scheme:"gmsk",modulation:{center_frequency:4200,gain:.1},outer_fec_scheme:"none",resampler:{attenuation:60,bandwidth:.45,delay:13,filter_bank_size:64}},"audible-7k-channel-0":{checksum_scheme:"crc32",encoder_filters:{dc_filter_alpha:.01},frame_length:600,inner_fec_scheme:"rs8",interpolation:{excess_bandwidth:.31,samples_per_symbol:6,shape:"kaiser",symbol_delay:4},mod_scheme:"arb16opt",modulation:{center_frequency:9200,gain:.1},ofdm:{cyclic_prefix_length:8,left_band:0,num_subcarriers:48,right_band:0,taper_length:4},outer_fec_scheme:"v29",resampler:{attenuation:60,bandwidth:.45,delay:13,filter_bank_size:64}},"audible-7k-channel-1":{checksum_scheme:"crc32",encoder_filters:{dc_filter_alpha:.01},frame_length:600,inner_fec_scheme:"rs8",interpolation:{excess_bandwidth:.31,samples_per_symbol:6,shape:"kaiser",symbol_delay:4},mod_scheme:"arb16opt",modulation:{center_frequency:15500,gain:.1},ofdm:{cyclic_prefix_length:8,left_band:0,num_subcarriers:48,right_band:0,taper_length:4},outer_fec_scheme:"v29",resampler:{attenuation:60,bandwidth:.45,delay:13,filter_bank_size:64}},"cable-64k":{checksum_scheme:"crc32",encoder_filters:{dc_filter_alpha:.03},frame_length:7500,inner_fec_scheme:"v27p23",interpolation:{excess_bandwidth:.35,samples_per_symbol:2,shape:"kaiser",symbol_delay:4},mod_scheme:"qam1024",modulation:{center_frequency:10200,gain:.09},ofdm:{cyclic_prefix_length:16,left_band:6,num_subcarriers:128,right_band:12,taper_length:8},outer_fec_scheme:"rs8",resampler:{attenuation:60,bandwidth:.45,delay:13,filter_bank_size:64}},"hello-world":{checksum_scheme:"crc32",encoder_filters:{dc_filter_alpha:.01},frame_length:25,inner_fec_scheme:"v27",interpolation:{excess_bandwidth:.38,samples_per_symbol:20,shape:"kaiser",symbol_delay:4},mod_scheme:"gmsk",modulation:{center_frequency:4400,gain:.08},outer_fec_scheme:"none",resampler:{attenuation:60,bandwidth:.45,delay:13,filter_bank_size:64}},ultrasonic:{checksum_scheme:"crc32",encoder_filters:{dc_filter_alpha:.01},frame_length:75,inner_fec_scheme:"v27",interpolation:{excess_bandwidth:.35,samples_per_symbol:14,shape:"rrcos",symbol_delay:4},mod_scheme:"gmsk",modulation:{center_frequency:19e3,gain:.1},outer_fec_scheme:"none",resampler:{attenuation:60,bandwidth:.45,delay:13,filter_bank_size:64}},"ultrasonic-3600":{checksum_scheme:"crc8",encoder_filters:{dc_filter_alpha:.01},frame_length:550,inner_fec_scheme:"v27",interpolation:{excess_bandwidth:.33,samples_per_symbol:7,shape:"kaiser",symbol_delay:4},mod_scheme:"V29",modulation:{center_frequency:18500,gain:.1},ofdm:{cyclic_prefix_length:20,left_band:4,num_subcarriers:64,right_band:13,taper_length:8},outer_fec_scheme:"none",resampler:{attenuation:60,bandwidth:.45,delay:13,filter_bank_size:64}},"ultrasonic-experimental":{checksum_scheme:"crc32",encoder_filters:{dc_filter_alpha:.01},frame_length:100,header:{checksum_scheme:"crc32",inner_fec_scheme:"secded7264",mod_scheme:"bpsk",outer_fec_scheme:"v29"},inner_fec_scheme:"rs8",interpolation:{excess_bandwidth:.31,samples_per_symbol:10,shape:"kaiser",symbol_delay:4},mod_scheme:"bpsk",modulation:{center_frequency:19e3,gain:.2},outer_fec_scheme:"v29",resampler:{attenuation:60,bandwidth:.45,delay:13,filter_bank_size:64}},"ultrasonic-whisper":{checksum_scheme:"crc32",encoder_filters:{dc_filter_alpha:.01},frame_length:16,inner_fec_scheme:"v27",interpolation:{excess_bandwidth:.35,samples_per_symbol:30,shape:"rrcos",symbol_delay:4},mod_scheme:"gmsk",modulation:{center_frequency:19500,gain:.1},outer_fec_scheme:"none",resampler:{attenuation:60,bandwidth:.45,delay:13,filter_bank_size:64}}}},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r,i=n(0);function a(e){if(r)return r;var t=e.emscriptenPath,n=e.memoryInitializerPath;window.quiet_emscripten_config=window.quiet_emscripten_config||{},window.quiet_emscripten_config.locateFile=function(e){if("quiet-emscripten.js.mem"===e)return"".concat(n,"quiet-emscripten.js.mem")};var a=new Promise(function(e){window.quiet_emscripten_config.onRuntimeInitialized=e});return r=new Promise(function(e,n){var r=document.createElement("script");r.async=!0,r.addEventListener("error",function(){r.remove(),n()}),r.addEventListener("load",e),r.type="text/javascript",r.src="".concat(t,"quiet-emscripten.js"),document.head.appendChild(r)}).then(function(){return i.a.set(window.quiet_emscripten)}).then(function(){return a}).catch(function(e){return r=null,Promise.reject(e)})}},function(e,t,n){"use strict";function r(e){var t=String.fromCharCode.apply(null,new Uint8Array(e)),n=escape(t);return decodeURIComponent(n)}function i(e,t){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n.buffer}function a(e){for(var t=unescape(encodeURIComponent(e)),n=new ArrayBuffer(t.length),r=new Uint8Array(n),i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return n}n.d(t,"a",function(){return r}),n.d(t,"b",function(){return i}),n.d(t,"c",function(){return a})},function(e,t,n){"use strict";var r=n(1),i=n(2),a=n(0);function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._decoder=Object(i.a)("decoder",t,n),r&&a.a.get().ccall("quiet_decoder_enable_stats",null,["pointer"],[this._decoder])}var t,n,o;return t=e,(n=[{key:"consume",value:function(e){a.a.get().ccall("quiet_decoder_consume","number",["pointer","pointer","number"],[this._decoder,e.getRawSamples(),r.b])}},{key:"destroy",value:function(){a.a.get().ccall("quiet_decoder_destroy",null,["pointer"],[this._decoder]),this._decoder=null}},{key:"getChecksumFails",value:function(){return a.a.get().ccall("quiet_decoder_checksum_fails","number",["pointer"],[this._decoder])}},{key:"getReceiverStats",value:function(){var e=a.a.get(),t=e.ccall("malloc","pointer",["number"],[4]),n=e.ccall("quiet_decoder_consume_stats","pointer",["pointer","pointer"],[this._decoder,t]),r=e.HEAPU32[t/4];e.ccall("free",null,["pointer"],[t]);for(var i=[],s=0;s<r;s++){for(var o=(n+20*s)/4,c=e.HEAPU32[o],u=e.HEAPU32[o+1],l={errorVectorMagnitude:e.HEAPF32[o+2],receivedSignalStrengthIndicator:e.HEAPF32[o+3],symbols:[]},_=0;_<u;_++){var d=(c+8*_)/4;l.symbols.push({real:e.HEAPF32[d],imag:e.HEAPF32[d+1]})}i.push(l)}return e.ccall("free",null,["pointer"],[r]),i}},{key:"readFrame",value:function(e){return a.a.get().ccall("quiet_decoder_recv","number",["pointer","pointer","number"],[this._decoder,e.getRawFrame(),r.a])}}])&&s(t.prototype,n),o&&s(t,o),e}(),c=n(21);function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._frame=a.a.get().ccall("malloc","pointer",["number"],[r.a])}var t,n,i;return t=e,(n=[{key:"createFrameArray",value:function(e){return a.a.get().HEAP8.slice(this._frame,this._frame+e)}},{key:"destroy",value:function(){a.a.get().ccall("free",null,["pointer"],[this._frame])}},{key:"getRawFrame",value:function(){return this._frame}}])&&u(t.prototype,n),i&&u(t,i),e}();function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=t.audioStream,i=t.onReceive,a=t.onReceiveFail,s=t.onReceiverStatsUpdate,u=t.profile;this._onReceive=i,this._onReceiveFail=a,this._onReceiverStatsUpdate=s,this._onAudioProcess=this._onAudioProcess.bind(this),this._consume=this._consume.bind(this),this._readBuffer=this._readBuffer.bind(this),this._destroyed=!1,this._lastChecksumFailCount=0,this._lastConsumeTimes=[],this._audioCtx=new(window.AudioContext||window.webkitAudioContext),this._audioInput=this._audioCtx.createMediaStreamSource(n),this._scriptProcessor=this._audioCtx.createScriptProcessor(r.b,2,1),this._audioInput.connect(this._scriptProcessor),this._decoder=new o(u,this._audioCtx.sampleRate,!!s),this._samples=new c.a,this._frame=new l,this._scriptProcessor.onaudioprocess=this._onAudioProcess,this._fakeGain=this._audioCtx.createGain(),this._fakeGain.value=0,this._scriptProcessor.connect(this._fakeGain),this._fakeGain.connect(this._audioCtx.destination)}var t,n,i;return t=e,(n=[{key:"changeAudioStream",value:function(e){this._audioInput.disconnect(),this._audioInput=this._audioCtx.createMediaStreamSource(e),this._audioInput.connect(this._scriptProcessor)}},{key:"destroy",value:function(){this._destroyed||(this._audioInput.disconnect(),this._fakeGain.disconnect(),this._scriptProcessor.disconnect(),this._samples.destroy(),this._frame.destroy(),this._decoder.destroy,this._decoder=null,this._destroyed=!0)}},{key:"getAverageDecodeTime",value:function(){return this._lastConsumeTimes.length?this._lastConsumeTimes.reduce(function(e,t){return e+t},0)/this._lastConsumeTimes.length:0}},{key:"_consume",value:function(){var e=this;if(!this._destroyed){var t=new Date;this._decoder.consume(this._samples);var n=new Date;this._lastConsumeTimes.unshift(n-t),this._lastConsumeTimes.length>3&&this._lastConsumeTimes.pop(),window.setTimeout(this._readBuffer,0);var r=this._decoder.getChecksumFails();if(this._onReceiveFail&&r>this._lastChecksumFailCount&&window.setTimeout(function(){return e._onReceiveFail(r)},0),this._lastChecksumFailCount=r,this._onReceiverStatsUpdate){var i=this._decode.getReceiverStats();this._onReceiverStatsUpdate(i)}}}},{key:"_onAudioProcess",value:function(e){var t=this;if(!this._destroyed){var n=e.inputBuffer.getChannelData(0);this._samples.createSampleView().set(n),window.setTimeout(function(){return t._consume()},0)}}},{key:"_readBuffer",value:function(){if(!this._destroyed)for(;;){var e=this._decoder.readFrame(this._frame);if(-1===e)break;var t=this._frame.createFrameArray(e);this._onReceive(t.buffer)}}}])&&_(t.prototype,n),i&&_(t,i),e}();t.a=d},function(e,t,n){"use strict";var r=n(1),i=n(2),a=n(0);function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._encoder=Object(i.a)("encoder",t,n)}var t,n,o;return t=e,(n=[{key:"createFrameLength",value:function(e){var t=a.a.get();return e?t.ccall("quiet_encoder_clamp_frame_len","number",["pointer","number"],[this._encoder,r.b]):t.ccall("quiet_encoder_get_frame_len","number",["pointer"],[this._encoder])}},{key:"destroy",value:function(){a.a.get().ccall("quiet_encoder_destroy",null,["pointer"],[this._encoder])}},{key:"emit",value:function(e){return a.a.get().ccall("quiet_encoder_emit","number",["pointer","pointer","number"],[this._encoder,e.getRawSamples(),r.b])}},{key:"send",value:function(e){return a.a.get().ccall("quiet_encoder_send","number",["pointer","array","number"],[this._encoder,new Uint8Array(e),e.byteLength])}}])&&s(t.prototype,n),o&&s(t,o),e}(),c=n(21);function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=t.clampFrame,r=t.onEnqueue,i=t.onFinish,a=t.profile;this._onAudioProcess=this._onAudioProcess.bind(this),this._writebuf=this._writebuf.bind(this),this._audioCtx=new(window.AudioContext||window.webkitAudioContext),this._done=i,this._onEnqueue=r,this._encoder=new o(a,this._audioCtx.sampleRate),this._frameLen=this._encoder.createFrameLength(n),this._samples=new c.a,this._sample_view=this._samples.createSampleView(),this._dummy_osc,this._destroyed=!1,this._emptiesWritten=0,this._lastEmitTimes=[],this._payload=[],this._played=!0,this._running=!1,this._transmitter}var t,n,i;return t=e,(n=[{key:"destroy",value:function(){this._destroyed||(this._samples.destroy(),this._encoder.destroy(),!0===this._running&&this.stopTransmitter(),this._destroyed=!0)}},{key:"getAverageEncodeTime",value:function(){return this._lastEmitTimes.length?this._lastEmitTimes.reduce(function(e,t){return e+t},0)/this._lastEmitTimes.length:0}},{key:"getFrameLength",value:function(){return this._frameLen}},{key:"startTransmitter",value:function(){if(!this._destroyed){if(!this._transmitter){var e=this._audioCtx.createScriptProcessor||this._audioCtx.createJavaScriptNode;this._transmitter=e.call(this._audioCtx,r.b,1,2),this._transmitter.onaudioprocess=this._onAudioProcess,this._dummy_osc=this._audioCtx.createOscillator(),this._dummy_osc.type="square",this._dummy_osc.frequency.value=420}this._dummy_osc.connect(this._transmitter),this._transmitter.connect(this._audioCtx.destination),this._running=!0}}},{key:"stopTransmitter",value:function(){this._destroyed||(this._dummy_osc.disconnect(),this._transmitter.disconnect(),this._running=!1)}},{key:"transmit",value:function(e){if(!this._destroyed){for(var t=0;t<e.byteLength;){var n=e.slice(t,t+this._frameLen);t+=n.byteLength,this._payload.push(n)}this._writebuf()}}},{key:"_onAudioProcess",value:function(e){var t=e.outputBuffer.getChannelData(0);if(!0!==this._played)this._played=!0,t.set(this._sample_view),window.setTimeout(this._writebuf,0);else for(var n=0;n<r.b;n++)t[n]=0}},{key:"_writebuf",value:function(){if(!this._destroyed){for(var e=!1,t=!1;;){var n=this._payload.shift();if(void 0===n)break;if(e=!0,-1===this._encoder.send(n)){this._payload.unshift(n);break}t=!0}if(t&&!this._payload.length&&this._onEnqueue&&window.setTimeout(this._onEnqueue,0),e&&!this._running&&this.startTransmitter(),this._played){var i=new Date,a=this._encoder.emit(this._samples),s=new Date;if(this._lastEmitTimes.unshift(s-i),this._lastEmitTimes.length>3&&this._lastEmitTimes.pop(),!e&&-1===a){if(this._emptiesWritten<3){for(var o=0;o<r.b;o++)this._sample_view[o]=0;return this._emptiesWritten++,void(this._played=!1)}return this._done&&this._done(),void(this._running&&this.stopTransmitter())}if(this._played=!1,this._emptiesWritten=0,a<r.b)for(var c=a;c<r.b;c++)this._sample_view[c]=0}}}}])&&u(t.prototype,n),i&&u(t,i),e}();t.a=l},function(e,t,n){"use strict";n.r(t);var r=n(9);n.d(t,"Receiver",function(){return r.a});var i=n(10);n.d(t,"Transmitter",function(){return i.a});var a=n(8);n.d(t,"ab2str",function(){return a.a}),n.d(t,"mergeab",function(){return a.b}),n.d(t,"str2ab",function(){return a.c});var s=n(7);n.d(t,"loadDependencies",function(){return s.a});var o=n(6);n.d(t,"profiles",function(){return o.a})},,,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(1),i=n(0);function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.b;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._bufferSize=t,this._samples=i.a.get().ccall("malloc","pointer",["number"],[4*r.b])}var t,n,s;return t=e,(n=[{key:"createSampleView",value:function(){return i.a.get().HEAPF32.subarray(this._samples/4,this._samples/4+r.b)}},{key:"destroy",value:function(){i.a.get().ccall("free",null,["pointer"],[this._samples]),this._samples=null}},{key:"getBufferSize",value:function(){return this._bufferSize}},{key:"getRawSamples",value:function(){return this._samples}}])&&a(t.prototype,n),s&&a(t,s),e}()}])});